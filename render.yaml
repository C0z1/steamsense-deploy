services:
  # ── Backend FastAPI ─────────────────────────────────────────────────────────
  - type: web
    name: steamsense-backend
    runtime: python
    plan: free
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health

    # NOTA: El plan Free no soporta discos persistentes.
    # DuckDB usará almacenamiento temporal — los datos se pierden al redeploy.
    # Para persistencia real, cambia plan: free → plan: starter y descomenta:
    # disk:
    #   name: steamsense-db
    #   mountPath: /data
    #   sizeGB: 1

    envVars:
      - key: ENV
        value: production
      - key: DUCKDB_PATH
        value: /tmp/steamsense.duckdb   # /tmp es el único path escribible en Free
      - key: TOP_N_GAMES
        value: "200"
      - key: STEAM_API_KEY
        sync: false
      - key: ITAD_API_KEY
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: CORS_ORIGINS
        sync: false
      - key: FRONTEND_URL
        sync: false
      - key: BACKEND_URL
        sync: false
